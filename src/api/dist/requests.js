"use strict";
exports.__esModule = true;
// src/api/request.ts
var axios_1 = require("axios");
var react_hot_toast_1 = require("react-hot-toast");
/**
 * use 'npm start' ,  NODE_ENV='development'.
 * use 'npm run build'  , NODE_ENV='production' , use Nginx Proxy
 */
var API_BASE_URL = process.env.NODE_ENV === 'development' ? 'http://localhost:5001/api/v1' : '/api/v1';
/**
 * Authentication Mechanism Overview:
 * 1. Generation & Storage: The ACCESS-TOKEN is generated by the back-end upon successful login.
 * 2. Automatic Transmission: All subsequent HTTP requests to the back-end server will automatically carry
 *    the ACCESS-TOKEN within the HTTP Only Cookie.
 * 3. Token Expiry: This automatic carriage continues until the token's validity period has passed
 * (or the cookie's maxAge is reached).
 */
var apiV1 = axios_1["default"].create({
    baseURL: API_BASE_URL,
    timeout: 5000,
    //Ensure that HTTP Only cookies are carried while cross-domain request
    withCredentials: true
});
apiV1.interceptors.response.use(
//success: 2xx code
function (response) {
    return response;
}, 
//error
function (error) {
    var _a, _b;
    // 统一处理 401/403 等需要全局操作的错误 (例如，重定向到登录页)
    // if (status === HttpStatusCode.Unauthorized || status === HttpStatusCode.Forbidden) {
    //     // ... 处理未授权逻辑
    // }
    var msg = ((_b = (_a = error === null || error === void 0 ? void 0 : error.response) === null || _a === void 0 ? void 0 : _a.data) === null || _b === void 0 ? void 0 : _b.message) || (error === null || error === void 0 ? void 0 : error.message) || '服务器错误，请稍后再试';
    react_hot_toast_1.toast.error(msg);
    error.displayMessage = msg;
    return Promise.reject(error);
});
exports["default"] = apiV1;
